<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cottontail - Innovation Numérique</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@300;400;500;600;700&family=Noto+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    
    <!-- External CSS - Utilisation de ./ pour forcer le chemin relatif -->
    <link rel="stylesheet" href="./styles.css">
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>

    <header id="header">
        <div class="container header-inner">
            <div class="logo">
                <img src="./logo/dessin.svg" alt="Cottontail" class="logo-image logo-mobile" />
                <img src="./images/logo_complet.png" alt="Cottontail" class="logo-image logo-desktop" />
            </div>
            <nav class="main-nav">
                <a href="#hero" class="nav-link active" data-color="blue">Innovation</a>
                <a href="#expertise" class="nav-link" data-color="orange">Expertise</a>
                <a href="#vision" class="nav-link" data-color="yellow">Vision</a>
            </nav>

            <!-- Mobile Navigation Cube -->
            <div class="mobile-nav-cube" id="mobileNavCube">
                <div class="cube-container">
                    <div class="cube" id="navCube">
                        <div class="cube-face cube-face-front" data-section="hero" data-color="blue">Innovation</div>
                        <div class="cube-face cube-face-bottom" data-section="expertise" data-color="orange">Expertise</div>
                        <div class="cube-face cube-face-back" data-section="vision" data-color="yellow">Vision</div>
                        <div class="cube-face cube-face-top" data-section="hero" data-color="blue">Innovation</div>
                    </div>
                </div>
            </div>
            <a href="#contact" class="btn-contact">Contact</a>
        </div>
    </header>

    <main>
        <section class="hero" id="hero">
            <div class="container">
                <h1 class="hero-title">L'Innovation numérique,<br><span class="blue hero-word-animate">maîtrisée.</span></h1>

                <div class="carousel-wrapper">
                    <div class="carousel-container" id="carousel">
                        <!-- Spacer invisible pour centrer la première carte -->
                        <div class="carousel-spacer"></div>

                        <!-- Slide 1 - Expertise IA -->
                        <div class="project-card slide-card" data-slide="0">
                            <div class="card-bg slide-bg-dark"></div>
                            <div class="slide-content-centered">
                                <div class="slide-text-container">
                                    <div class="slide-main-text apple-text-reveal">
                                        <span class="text-line" data-delay="0">Sécurisé.</span>
                                        <span class="text-line" data-delay="1">Maîtrisé.</span>
                                        <span class="text-line" data-delay="2">Utile.</span>
                                    </div>
                                    <p class="slide-subtext apple-fade-in">IA déployée sur vos infrastructures, selon vos contraintes.</p>
                                </div>
                                <a href="#contact" class="slide-cta-btn">Discuter de votre projet</a>
                            </div>
                        </div>

                        <!-- Slide 2 - Perspective -->
                        <div class="project-card slide-card" data-slide="1">
                            <div class="card-bg slide-bg-dark"></div>
                            <div class="slide-content-centered">
                                <div class="slide-text-container">
                                    <div class="slide-main-text apple-text-reveal">
                                        <span class="text-line" data-delay="0">Penser plus loin</span>
                                        <span class="text-line" data-delay="1">que la première version.</span>
                                    </div>
                                    <p class="slide-subtext apple-fade-in">Évolutivité, rentabilité, vision globale.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Slide 3 - Réalisation -->
                        <div class="project-card slide-card" data-slide="2">
                            <div class="card-bg slide-bg-dark"></div>
                            <div class="slide-content-centered">
                                <div class="slide-text-container">
                                    <div class="slide-main-text apple-text-reveal">
                                        <span class="text-line" data-delay="0">Quand le numérique</span>
                                        <span class="text-line" data-delay="1">s'intègre au réel.</span>
                                    </div>
                                    <p class="slide-subtext apple-fade-in">Processus métier, données, décisions humaines.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Spacer invisible pour centrer la dernière carte -->
                        <div class="carousel-spacer"></div>
                    </div>

                </div>
            </div>
        </section>

        <section class="expertise" id="expertise">
            <!-- Animation Expertise - 3 phases avec scroll hijacking -->
            <div class="expertise-animation" id="expertiseAnimation" data-current-phase="1">

                <!-- Téléphone unique qui se déplace entre les phases -->
                <div class="unified-phone" id="unifiedPhone">
                    <img src="./images/expertise/blank-phone.png" alt="Phone" class="phone-image">

                    <!-- Contenu Phase 1: Loader -->
                    <div class="phone-content content-phase-1">
                        <div class="phone-loader">
                            <div class="loader-spinner"></div>
                        </div>
                    </div>

                    <!-- Contenu Phase 2: Logo Lupin -->
                    <div class="phone-content content-phase-2">
                        <div class="lupin-logo-container">
                            <img src="./images/expertise/logo_lupin.png" alt="Lupin" class="lupin-logo">
                            <span class="lupin-loading-text">Lupin prépare votre espace...</span>
                        </div>
                    </div>

                    <!-- Contenu Phase 3: Screenshot -->
                    <div class="phone-content content-phase-3">
                        <img src="./images/expertise/screenshot-phase3.jpg" alt="Application Lupin" class="phone-screenshot">
                    </div>
                </div>

                <!-- Phase 1: Diagramme complet -->
                <div class="expertise-phase phase-1 active" data-phase="1">
                    <div class="diagram-container">
                        <!-- Conteneur SVG Phase 1 -->
                        <div class="diagram-svg-wrapper">
                            <img src="./images/expertise/phase1.svg"
                                 alt="Architecture Phase 1"
                                 class="phase1-svg-diagram">
                        </div>
                    </div>
                </div>

                <!-- Phase 2: Diagramme simplifié + téléphone qui grandit -->
                <div class="expertise-phase phase-2" data-phase="2">
                    <div class="diagram-container">
                        <!-- Conteneur SVG Phase 2 -->
                        <div class="diagram-svg-wrapper">
                            <img src="./images/expertise/phase2.svg"
                                 alt="Architecture Phase 2"
                                 class="phase2-svg-diagram">
                        </div>
                    </div>
                </div>

                <!-- Phase 3: Texte elegant style -->
                <div class="expertise-phase phase-3" data-phase="3">
                    <div class="phase3-content">
                        <!-- Texte elegant style -->
                        <div class="elegant-text">
                            <p class="elegant-line line-1">Vous avez une idée.</p>
                            <p class="elegant-line line-2">On s'occupe du reste.</p>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <section class="vision" id="vision">
            <div class="container">
                <div style="text-align: center; max-width: 800px; margin: 0 auto;">
                    <h2 class="section-title" style="margin-bottom: 1.5rem;">Une Vision <span class="yellow">Élargie</span></h2>
                    <p style="color: var(--color-text-secondary);">Notre expertise ne s'arrête pas à un écran. Nous concevons des écosystèmes complets qui s'adaptent à tous les usages de vos utilisateurs.</p>
                </div>

                <div class="vision-grid">
                    <div class="vision-card">
                        <div class="vision-icon">
                            <span class="material-symbols-outlined" style="font-size: 32px;">devices</span>
                        </div>
                        <h3>Multi-Support</h3>
                        <p>Web, Mobile & Tablette</p>
                    </div>
                    <div class="vision-card">
                        <div class="vision-icon">
                            <span class="material-symbols-outlined" style="font-size: 32px;">cloud_sync</span>
                        </div>
                        <h3>Cloud Native</h3>
                        <p>Scalabilité & Performance</p>
                    </div>
                    <div class="vision-card">
                        <div class="vision-icon">
                            <span class="material-symbols-outlined" style="font-size: 32px;">security</span>
                        </div>
                        <h3>Sécurité</h3>
                        <p>Protection des Données</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="contact" id="contact">
            <div class="contact-header">
                <h2>Parlons de votre projet.</h2>
                <p>Une idée, un besoin ? Nous sommes là pour vous accompagner.</p>
            </div>

            <div class="bento-grid">
                <!-- Grande carte Map - occupe 2 colonnes -->
                <div class="bento-card bento-map">
                    <img src="./images/Icone.PNG" alt="Cottontail" class="bento-map-image">
                    <iframe
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d166.30304912080229!2d6.451889037412049!3d48.17099556282759!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4793a08efd32d2f5%3A0x6b697bf99e10bb8d!2s5%20Rue%20des%20Jardiniers%2C%2088000%20%C3%89pinal!5e0!3m2!1sfr!2sfr!4v1765880135382!5m2!1sfr!2sfr"
                        allowfullscreen=""
                        loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>

                <!-- Carte Téléphone -->
                <a href="tel:+33685680467" class="bento-card bento-phone">
                    <div class="bento-icon">
                        <span class="material-symbols-outlined">phone</span>
                    </div>
                    <div class="bento-content">
                        <span class="bento-label">Téléphone</span>
                        <p class="bento-value">06 85 68 04 67</p>
                        <span class="bento-sub">Lun-Ven, 9h-18h</span>
                    </div>
                </a>

                <!-- Carte Email -->
                <a href="mailto:contact@cottontail-logiciels.fr" class="bento-card bento-email">
                    <div class="bento-icon">
                        <span class="material-symbols-outlined">mail</span>
                    </div>
                    <div class="bento-content">
                        <span class="bento-label">Email</span>
                        <p class="bento-value">contact@cottontail-logiciels.fr</p>
                        <span class="bento-sub">Réponse sous 24h</span>
                    </div>
                </a>

                <!-- Carte Adresse -->
                <a href="https://maps.google.com/?q=5+rue+des+jardiniers+88000+epinal" target="_blank" class="bento-card bento-address">
                    <div class="bento-icon">
                        <span class="material-symbols-outlined">location_on</span>
                    </div>
                    <div class="bento-content">
                        <span class="bento-label">Adresse</span>
                        <p class="bento-value">5 rue des Jardiniers</p>
                        <span class="bento-sub">88000 Épinal, France</span>
                    </div>
                </a>

                <!-- Carte CTA -->
                <div class="bento-card bento-cta">
                    <h3>Prêt à démarrer ?</h3>
                    <p>Discutons de votre projet ensemble</p>
                    <div class="bento-cta-buttons">
                        <a href="tel:+33685680467" class="bento-btn-secondary">
                            <span class="material-symbols-outlined">call</span>
                            Appeler
                        </a>
                        <a href="mailto:contact@cottontail-logiciels.fr" class="bento-btn-secondary">
                            <span class="material-symbols-outlined">mail</span>
                            Email
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            © 2023 Cottontail. Tous droits réservés.
        </div>
    </footer>

    <script>
        // Header scroll effect and navigation tracking
        const header = document.getElementById('header');
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('section[id]');

        // Scroll effect for header
        let lastScroll = 0;
        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;

            // Add scrolled class for styling
            if (currentScroll > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }

            lastScroll = currentScroll;
        });

        // Active navigation based on scroll position
        function updateActiveNav() {
            const scrollPos = window.pageYOffset + 100; // Offset for header height

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;
                const sectionId = section.getAttribute('id');

                if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                    // Update header border color based on section
                    header.setAttribute('data-section', sectionId);

                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${sectionId}`) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }

        window.addEventListener('scroll', updateActiveNav);

        // Set initial active section
        updateActiveNav();

        // Mobile Navigation Cube
        const navCube = document.getElementById('navCube');
        const cubeFaces = document.querySelectorAll('.cube-face');
        const sectionOrder = ['hero', 'expertise', 'vision'];
        let currentCubePosition = 0;

        function updateCubePosition(sectionId) {
            const newPosition = sectionOrder.indexOf(sectionId);
            if (newPosition !== -1 && newPosition !== currentCubePosition) {
                currentCubePosition = newPosition;
                navCube.style.transform = `rotateX(${newPosition * 90}deg)`;
            }
        }

        // Update cube when scrolling
        function updateMobileCube() {
            const scrollPos = window.pageYOffset + 100;

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;
                const sectionId = section.getAttribute('id');

                if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                    if (sectionOrder.includes(sectionId)) {
                        updateCubePosition(sectionId);
                    }
                }
            });
        }

        window.addEventListener('scroll', updateMobileCube);

        // Click on cube face to navigate
        cubeFaces.forEach(face => {
            face.addEventListener('click', () => {
                const targetSection = face.getAttribute('data-section');
                const targetElement = document.getElementById(targetSection);

                if (targetElement) {
                    const headerHeight = header.offsetHeight;
                    const targetPosition = targetElement.offsetTop - headerHeight;

                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Initialize cube position
        updateMobileCube();

        // Smooth scroll for navigation links
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);

                if (targetSection) {
                    const headerHeight = header.offsetHeight;
                    const targetPosition = targetSection.offsetTop - headerHeight;

                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Smooth scroll for contact button
        const btnContact = document.querySelector('.btn-contact');
        if (btnContact) {
            btnContact.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = btnContact.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);

                if (targetSection) {
                    const headerHeight = header.offsetHeight;
                    const targetPosition = targetSection.offsetTop - headerHeight;
                    const startPosition = window.pageYOffset;
                    const distance = targetPosition - startPosition;
                    const duration = 1200; // Durée plus longue pour un scroll plus doux
                    let startTime = null;

                    function easeInOutCubic(t) {
                        return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
                    }

                    function animation(currentTime) {
                        if (startTime === null) startTime = currentTime;
                        const timeElapsed = currentTime - startTime;
                        const progress = Math.min(timeElapsed / duration, 1);
                        const ease = easeInOutCubic(progress);

                        window.scrollTo(0, startPosition + distance * ease);

                        if (timeElapsed < duration) {
                            requestAnimationFrame(animation);
                        }
                    }

                    requestAnimationFrame(animation);
                }
            });
        }

        // Carousel functionality
        const carousel = document.getElementById('carousel');
        const dots = document.querySelectorAll('.dot');
        const projectCards = document.querySelectorAll('.project-card');
        const carouselSpacer = document.querySelector('.carousel-spacer');

        function updateDots() {
            if (!carousel) return;
            const containerCenter = carousel.getBoundingClientRect().left + carousel.offsetWidth / 2;
            
            let closestIndex = 0;
            let minDistance = Infinity;

            projectCards.forEach((card, index) => {
                const cardRect = card.getBoundingClientRect();
                const cardCenter = cardRect.left + cardRect.width / 2;
                const distance = Math.abs(containerCenter - cardCenter);
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestIndex = index;
                }
            });

            dots.forEach((dot, index) => {
                if (index === closestIndex) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        carousel.addEventListener('scroll', updateDots);
        // Initial check
        updateDots();

        function scrollCarousel(direction) {
            const cardWidth = projectCards[0].offsetWidth;
            const gap = 32; // 2rem
            const scrollAmount = cardWidth + gap;
            
            carousel.scrollBy({
                left: direction * scrollAmount,
                behavior: 'smooth'
            });
        }

        function scrollToIndex(index) {
            const targetCard = projectCards[index];
            const targetLeft = targetCard.offsetLeft;
            const containerWidth = carousel.offsetWidth;
            // -16 accounts for padding/margins roughly to center visually in the padded container
            const scrollPos = targetLeft - (containerWidth / 2) + (targetCard.offsetWidth / 2) - 16;

            carousel.scrollTo({
                left: scrollPos,
                behavior: 'smooth'
            });
        }

        // ==========================================
        // Scroll vertical → Navigation des slides
        // Desktop uniquement
        // ==========================================
        (function() {
            if (window.innerWidth < 768) return; // Désactivé sur mobile

            const heroSection = document.getElementById('hero');
            const heroTitle = heroSection.querySelector('h1');
            const carouselWrapper = document.querySelector('.carousel-wrapper');
            const expertiseSection = document.getElementById('expertise');
            let isAnimating = false;
            let lastWheelTime = 0;
            const totalSlides = projectCards.length;
            const heroScrollOffset = 16;

            // Système d'activation du scroll hijacking plus robuste
            let scrollHijackEnabled = false;
            let isCarouselHovering = false;
            let rapidScrollCount = 0;
            let lastRapidScrollTime = 0;
            let hijackReenableTimer = null;

            // Activer le hijacking uniquement au survol du carousel
            if (carousel) {
                carousel.addEventListener('mouseenter', () => {
                    isCarouselHovering = true;
                    scrollHijackEnabled = true;
                });

                carousel.addEventListener('mouseleave', () => {
                    isCarouselHovering = false;
                    scrollHijackEnabled = false;
                    if (hijackReenableTimer) {
                        clearTimeout(hijackReenableTimer);
                        hijackReenableTimer = null;
                    }
                });
            }

            // Récupère l'index de la slide actuellement visible
            function getCurrentSlideIndex() {
                const containerCenter = carousel.getBoundingClientRect().left + carousel.offsetWidth / 2;
                let closestIndex = 0;
                let minDistance = Infinity;

                projectCards.forEach((card, index) => {
                    const cardRect = card.getBoundingClientRect();
                    const cardCenter = cardRect.left + cardRect.width / 2;
                    const distance = Math.abs(containerCenter - cardCenter);

                    if (distance < minDistance) {
                        minDistance = distance;
                        closestIndex = index;
                    }
                });

                return closestIndex;
            }

            // Scroll vers le titre h1 du hero
            function scrollToHeroTitle() {
                isAnimating = true;
                const headerHeight = header.offsetHeight;
                const targetPosition = Math.max(
                    heroTitle.offsetTop - headerHeight - heroScrollOffset,
                    0
                );
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
                setTimeout(() => { isAnimating = false; }, 600);
            }

            // Scroll vers une slide spécifique (avec marquage animation)
            function scrollToSlide(index) {
                isAnimating = true;
                scrollToIndex(index);
                setTimeout(() => { isAnimating = false; }, 600);
            }

            // Vérifie si on est au-dessus du hero (tout en haut de la page)
            function isAboveHero() {
                const headerHeight = header.offsetHeight;
                const triggerPoint = Math.max(
                    heroTitle.offsetTop - headerHeight - heroScrollOffset,
                    0
                );
                return window.scrollY < triggerPoint;
            }

            // Vérifie si on arrive depuis la section expertise (en remontant)
            function isAtExpertiseTop() {
                const rect = expertiseSection.getBoundingClientRect();
                return rect.top >= 0 && rect.top <= window.innerHeight;
            }

            // Vérifie si le carousel est bien visible à l'écran
            function isCarouselInView() {
                const rect = carouselWrapper.getBoundingClientRect();
                const viewportHeight = window.innerHeight;
                const visibleTop = Math.max(0, rect.top);
                const visibleBottom = Math.min(viewportHeight, rect.bottom);
                const visibleHeight = visibleBottom - visibleTop;
                return visibleHeight > rect.height * 0.4;
            }

            // Vérifie si le titre hero est visible
            function isHeroTitleInView() {
                const rect = heroTitle.getBoundingClientRect();
                return rect.top >= -50 && rect.bottom <= window.innerHeight + 50;
            }

            // Gestionnaire du scroll vertical
            function handleWheelScroll(e) {
                if (window.innerWidth < 768) return;
                if (!isCarouselHovering) return;
                if (!scrollHijackEnabled) return;
                if (Math.abs(e.deltaY) < 30) return;

                const now = Date.now();

                // Détection de scroll rapide répété (échappatoire utilisateur)
                if (now - lastRapidScrollTime < 150) {
                    rapidScrollCount++;
                    if (rapidScrollCount > 4) {
                        // L'utilisateur force le scroll, désactiver temporairement
                        scrollHijackEnabled = false;
                        if (hijackReenableTimer) {
                            clearTimeout(hijackReenableTimer);
                        }
                        hijackReenableTimer = setTimeout(() => {
                            if (isCarouselHovering) {
                                scrollHijackEnabled = true;
                            }
                            rapidScrollCount = 0;
                            hijackReenableTimer = null;
                        }, 1500);
                        return; // Laisser le scroll natif
                    }
                } else {
                    rapidScrollCount = 0;
                }
                lastRapidScrollTime = now;

                // Throttling: bloquer seulement si une animation est en cours
                if (now - lastWheelTime < 600) {
                    if (isAnimating) {
                        e.preventDefault();
                    }
                    return;
                }

                // CAS 1: On est tout en haut et on scroll vers le bas → aller au titre
                if (isAboveHero() && e.deltaY > 0) {
                    e.preventDefault();
                    lastWheelTime = now;
                    scrollToHeroTitle();
                    return;
                }

                // CAS 2: On est sur le titre et on scroll vers le bas → aller à la slide 0
                if (isHeroTitleInView() && !isCarouselInView() && e.deltaY > 0) {
                    e.preventDefault();
                    lastWheelTime = now;
                    scrollToSlide(0);
                    return;
                }

                // CAS 3: On est sur le carousel
                if (isCarouselInView()) {
                    const currentSlide = getCurrentSlideIndex();

                    if (e.deltaY > 0) {
                        // Scroll vers le bas
                        if (currentSlide < totalSlides - 1) {
                            e.preventDefault();
                            lastWheelTime = now;
                            scrollToSlide(currentSlide + 1);
                        }
                        // Dernière slide → laisser continuer vers expertise
                    } else if (e.deltaY < 0) {
                        // Scroll vers le haut
                        if (isAtExpertiseTop()) {
                            e.preventDefault();
                            lastWheelTime = now;
                            scrollToHeroTitle();
                            return;
                        }
                        if (currentSlide > 0) {
                            e.preventDefault();
                            lastWheelTime = now;
                            scrollToSlide(currentSlide - 1);
                        } else {
                            e.preventDefault();
                            lastWheelTime = now;
                            scrollToHeroTitle();
                        }
                    }
                    return;
                }

                // CAS 4: On remonte depuis expertise → aller au titre
                if (isAtExpertiseTop() && e.deltaY < 0) {
                    e.preventDefault();
                    lastWheelTime = now;
                    scrollToHeroTitle();
                    // Remettre le carousel sur la dernière slide
                    setTimeout(() => {
                        scrollToSlide(totalSlides - 1);
                    }, 300);
                    return;
                }
            }

            window.addEventListener('wheel', handleWheelScroll, { passive: false });
        })();

        // ==========================================
        // Slide Card Active State & Animation
        // ==========================================
        (function() {
            const slideCards = document.querySelectorAll('.slide-card');
            let currentActiveSlide = -1;

            function updateActiveSlide() {
                if (!carousel) return;
                const containerCenter = carousel.getBoundingClientRect().left + carousel.offsetWidth / 2;

                let closestIndex = -1;
                let minDistance = Infinity;

                slideCards.forEach((card, index) => {
                    const cardRect = card.getBoundingClientRect();
                    const cardCenter = cardRect.left + cardRect.width / 2;
                    const distance = Math.abs(containerCenter - cardCenter);

                    if (distance < minDistance && distance < cardRect.width * 0.6) {
                        minDistance = distance;
                        closestIndex = index;
                    }
                });

                if (closestIndex !== currentActiveSlide) {
                    // Remove active from previous
                    slideCards.forEach((card, index) => {
                        if (index === currentActiveSlide && closestIndex !== -1) {
                            card.classList.add('slide-out-left');
                            card.classList.remove('active');
                            setTimeout(() => {
                                card.classList.remove('slide-out-left');
                            }, 400);
                        } else {
                            card.classList.remove('active');
                        }
                    });

                    // Add active to current
                    if (closestIndex !== -1) {
                        slideCards[closestIndex].classList.add('active');
                    }

                    currentActiveSlide = closestIndex;
                }
            }

            carousel.addEventListener('scroll', updateActiveSlide);
            // Initial check with delay to ensure proper positioning
            setTimeout(updateActiveSlide, 100);
        })();

        // ==========================================
        // Expertise Tiles - Apple-style Scroll Animation
        // ==========================================
        (function() {
            if (window.innerWidth < 768) return; // Disabled on mobile

            const expertiseSection = document.getElementById('expertise');
            const tilesContainer = document.getElementById('expertiseTiles');
            const tiles = tilesContainer?.querySelectorAll('.expertise-tile');
            const ctaButton = expertiseSection?.querySelector('.btn-cta');

            if (!expertiseSection || !tilesContainer || !tiles || !ctaButton) return;

            // Animation parameters
            const initialScale = 1.15;
            const finalScale = 1.0;
            const initialRotation = 15; // degrees for side tiles

            function updateTilesAnimation() {
                const sectionRect = expertiseSection.getBoundingClientRect();
                const tilesRect = tilesContainer.getBoundingClientRect();
                const ctaRect = ctaButton.getBoundingClientRect();
                const viewportHeight = window.innerHeight;

                // Calculate animation progress
                // Start when tiles enter viewport, end when CTA button reaches center
                const animationStart = viewportHeight; // tiles top enters viewport
                const animationEnd = viewportHeight * 0.4; // CTA near center

                // Current position of tiles top
                const currentPosition = tilesRect.top;

                // Calculate progress (0 = start, 1 = end)
                let progress = 0;
                if (currentPosition <= animationStart && currentPosition >= animationEnd) {
                    progress = (animationStart - currentPosition) / (animationStart - animationEnd);
                } else if (currentPosition < animationEnd) {
                    progress = 1;
                }

                // Clamp progress between 0 and 1
                progress = Math.max(0, Math.min(1, progress));

                // Apply easing (ease-out cubic)
                const easedProgress = 1 - Math.pow(1 - progress, 3);

                // Calculate current values
                const currentScale = initialScale - (initialScale - finalScale) * easedProgress;
                const currentRotation = initialRotation * (1 - easedProgress);

                // Apply to each tile
                tiles.forEach(tile => {
                    const tileIndex = parseInt(tile.dataset.tile);
                    let rotation = 0;

                    if (tileIndex === 0) {
                        rotation = -currentRotation; // Left tile rotates left
                    } else if (tileIndex === 2) {
                        rotation = currentRotation; // Right tile rotates right
                    }

                    tile.style.transform = `scale(${currentScale}) rotateY(${rotation}deg)`;
                });
            }

            // Use requestAnimationFrame for smooth animation
            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        updateTilesAnimation();
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            // Initial call
            updateTilesAnimation();
        })();

        // ==========================================
        // Expertise Animation - Scroll Hijacking
        // ==========================================
        (function() {
            const expertiseSection = document.getElementById('expertise');
            const expertiseAnimation = document.getElementById('expertiseAnimation');
            const phases = document.querySelectorAll('.expertise-phase');
            const elegantText = document.querySelector('.elegant-text');

            if (!expertiseSection || !phases.length) return;

            let currentPhase = 0;
            let isAnimating = false;
            let isInExpertiseSection = false;
            let lastWheelTime = 0;
            const totalPhases = phases.length;
            const animationDuration = 800; // ms

            // Initialiser la première phase comme active
            phases[0].classList.add('active');

            // Fonction pour changer de phase
            function goToPhase(phaseIndex) {
                if (phaseIndex < 0 || phaseIndex >= totalPhases) return;
                if (phaseIndex === currentPhase) return;

                isAnimating = true;

                // Retirer active de la phase actuelle
                phases[currentPhase].classList.remove('active');

                // Ajouter active à la nouvelle phase
                phases[phaseIndex].classList.add('active');

                // Mettre à jour l'attribut pour le téléphone unifié
                expertiseAnimation.setAttribute('data-current-phase', phaseIndex + 1);

                currentPhase = phaseIndex;

                // Activer l'animation du texte elegant sur la phase 3
                if (currentPhase === 2 && elegantText) {
                    setTimeout(() => {
                        elegantText.classList.add('animate');
                    }, 400);
                } else if (elegantText) {
                    elegantText.classList.remove('animate');
                }

                // Débloquer après l'animation
                setTimeout(() => {
                    isAnimating = false;
                }, animationDuration);
            }

            // Vérifier si la section expertise est visible
            function isExpertiseInView() {
                const rect = expertiseSection.getBoundingClientRect();
                const viewportHeight = window.innerHeight;
                // La section est "in view" si elle occupe la majorité du viewport
                return rect.top <= 100 && rect.bottom >= viewportHeight - 100;
            }

            // Vérifier si on est au début de la section (pour sortir vers le haut)
            function isAtSectionTop() {
                const rect = expertiseSection.getBoundingClientRect();
                return rect.top >= -50 && rect.top <= 100;
            }

            // Vérifier si on est à la fin de la section (pour sortir vers le bas)
            function isAtSectionBottom() {
                const rect = expertiseSection.getBoundingClientRect();
                return rect.bottom <= window.innerHeight + 50 && rect.bottom >= window.innerHeight - 100;
            }

            // Gestionnaire du scroll
            function handleWheel(e) {
                const now = Date.now();

                // Throttling
                if (now - lastWheelTime < 100) return;
                lastWheelTime = now;

                // Vérifier si on est dans la section expertise
                if (!isExpertiseInView()) {
                    isInExpertiseSection = false;
                    return;
                }

                isInExpertiseSection = true;

                // Si une animation est en cours, bloquer le scroll
                if (isAnimating) {
                    e.preventDefault();
                    return;
                }

                const deltaY = e.deltaY;
                const scrollingDown = deltaY > 0;
                const scrollingUp = deltaY < 0;

                // Scroll vers le bas
                if (scrollingDown) {
                    if (currentPhase < totalPhases - 1) {
                        e.preventDefault();
                        goToPhase(currentPhase + 1);
                    }
                    // Si on est à la dernière phase, laisser le scroll naturel continuer
                }

                // Scroll vers le haut
                if (scrollingUp) {
                    if (currentPhase > 0) {
                        e.preventDefault();
                        goToPhase(currentPhase - 1);
                    }
                    // Si on est à la première phase, laisser le scroll naturel continuer
                }
            }

            // Écouter le scroll
            window.addEventListener('wheel', handleWheel, { passive: false });

            // Réinitialiser quand on entre dans la section
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && entry.intersectionRatio > 0.5) {
                        // Reset à la phase 1 quand on entre par le haut
                        const rect = expertiseSection.getBoundingClientRect();
                        if (rect.top > 0) {
                            goToPhase(0);
                        }
                    }
                });
            }, { threshold: [0.5] });

            observer.observe(expertiseSection);
        })();

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
